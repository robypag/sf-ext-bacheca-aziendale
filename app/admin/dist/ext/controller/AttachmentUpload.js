sap.ui.define(["itg/sf/bachecaadmin/control/FileUploaderV4"],function(e){"use strict";return{onHandleFileDelete:function(e,t){if(t.length===0){var a=this._controller.oResourceBundle.getText("deleteMessageSelectEntry");new sap.m.MessageBox.show(a,{icon:sap.m.MessageBox.Icon.ERROR,title:"Errore",actions:sap.m.MessageBox.Action.OK})}else{t.forEach(e=>{e.delete();var t=e.getObject().ID;fetch(`admin/Attachments(ID=${t})`,{method:"DELETE"}).then(a=>{if(!a.ok){sap.m.MessageToast.show(`${a.status}-${a.statusText}`)}else{e.delete();e.refresh();sap.m.MessageToast.show(`Allegato ${t} cancellato correttamente`)}})})}},onHandleFileUpload:function(t,a){var s=new sap.m.MessageStrip({showIcon:true,text:"Durante la creazione di una nuova Pubblicazione, assicurarsi di <strong>salvare</strong> l'inserimento <strong>prima</strong> di caricare un allegato",enableFormattedText:true,type:sap.ui.core.MessageType.Warning});s.addStyleClass("sapUiSmallMargin");var n=new e({useMultipart:false,uploadUrl:"admin/Attachments",buttonOnly:true,icon:"sap-icon://upload-to-cloud",uploadComplete:function(e){sap.m.MessageToast.show(`Upload Completed!`);l.close()}});var o=new sap.m.VBox({width:"100%",alignItems:sap.m.FlexAlignItems.Center,justifyContent:sap.m.FlexJustifyContent.Center,items:[s,n]});o.addStyleClass("sapUiResponsivePadding");var l=new sap.m.Dialog({title:"Upload Attachment",type:sap.m.DialogType.Standard,content:o,beginButton:new sap.m.Button({text:"Upload",press:function(e){const a=n.oFileUpload.files[0];const s={name:a.name,mimeType:a.type||"text/plain",pubblication_ID:t.getObject().ID};fetch(`${n.getUploadUrl()}`,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(e=>{if(!e.ok){throw new Error(`${e.status}-${e.statusText}`)}else{return e.json()}}).then(e=>{n.setUploadUrl(`${n.getUploadUrl()}(ID=${e.ID},IsActiveEntity=${e.IsActiveEntity})/value`);n.setSendXHR(true);n.upload()}).catch(e=>{sap.m.MessageToast.show(`Error: ${e}`)})}}),endButton:new sap.m.Button({text:"Cancel",press:function(e){l.close()}}),afterClose:function(){l.destroy();t.refresh()}});l.open()}}});